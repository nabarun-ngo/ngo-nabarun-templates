name: Sync
on:
  workflow_call:
    inputs:
      auth0_target_env:
        required: true
        type: string
      firebase_target_env:
        required: true
        type: string
      sync_auth0:
        required: true
        type: boolean
      sync_firebaseRC:
        required: true
        type: boolean
      branch_name:
        required: false
        type: string
        default : 'main'
      
    secrets:
      firebase_source_project:
        required: false
      firebase_target_project:
        required: false
      auth0_source_config:
        required: false
      auth0_dest_config:
        required: false
      firebase_service_account_source:
        required: false
      firebase_service_account_target:
        required: false
        
jobs:

  sync_data_auth0:
    name: 'Sync Auth0 Data'
    runs-on: ubuntu-latest
    if: ${{ inputs.sync_auth0 }}
    environment: ${{ inputs.auth0_target_env }}
    steps:
      - name: Sync Auth0 Tenants
        uses: nabarun-ngo/ngo-nabarun-templates/.github/actions/sync-auth0-v2@main
        with:
          branch_name: ${{ inputs.branch_name }}
          source_config: ${{ secrets.auth0_source_config }}
          dest_config: ${{ secrets.auth0_dest_config }}

  sync_data_firebase:
    name: 'Sync Firebase Data'
    runs-on: ubuntu-latest
    if: ${{ inputs.sync_firebaseRC }}
    environment: ${{ inputs.firebase_target_env }}
    steps:
      - name: Sync Firebase Remote Config
        uses: nabarun-ngo/ngo-nabarun-templates/.github/actions/sync-firebase-v2@main
        with:
          branch_name: ${{ inputs.branch_name }}
          firebase_source_project: ${{ secrets.firebase_source_project }}
          firebase_target_project: ${{ secrets.firebase_target_project }}
          firebase_service_account_source: ${{ secrets.firebase_service_account_source }}
          firebase_service_account_target: ${{ secrets.firebase_service_account_target }}

      
    
